<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>muckiglück | App</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8A9A5B">
    <link rel="stylesheet" href="style.css">
    <link rel="apple-touch-icon" href="images/icon-192.png">
    <meta name="apple-mobile-web-app-title" content="muckiglück">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

</head>
<body>

    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-wrapper">
            <img src="images/icon-512.png" alt="muckiglück Logo" class="loading-logo">
            <h1 class="logo-text">muckiglück</h1>
            <div class="loader-dots">
                <span></span><span></span><span></span>
            </div>
            <p class="loading-subtext">Seite wird geladen...</p>
        </div>
    </div>

    <div id="main-content" style="display: none;">
        
        <header class="app-header">
            <div class="logo-container" style="display: flex; align-items: center; gap: 10px;">
                <img src="images/icon-192.png" alt="muckiglück Logo" style="height: 35px; width: 35px; border-radius: 8px; object-fit: cover;">
            </div>
            <div id="user-email" class="user-badge">Gast</div>
        </header>

        <main>
            <div id="install-container" style="display: none; padding: 20px; text-align: center;">
                <button id="btn-install" class="btn-primary" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <i data-lucide="download-cloud"></i>
                    muckiglück App installieren
                </button>
            </div>           
            <section class="hero">
                <h2>Herzlich Willkommen bei muckiglueck</h2>
                <p>Deine Begleitung für den Familienalltag</p>
            </section>

            <section id="about" class="container" style="margin-bottom: 40px;">
                <div class="about-header">
                    <div class="about-image">
                        <img src="images/Sophie.jpg" alt="Sophie">
                    </div>
                    <div>
                        <h3 style="margin:0;">Sophie</h3>
                        <p style="margin:0; font-size: 0.9rem; color: #666;">Familienbegleiterin</p>
                    </div>
                </div>
                <p style="font-size: 0.95rem; line-height: 1.6;">
                    Mit viel Empathie und Fachwissen unterstütze ich euch dabei, euren ganz eigenen Weg als Familie zu finden.
                </p>
            </section>

            <section id="services" class="container">
                <div class="section-title"><h2>Angebote</h2></div>
                
                <div class="services-grid">
                    <div class="service-card">
                        <img src="images/Schlafberatung.jpg" alt="Schlaf">
                        <div class="service-card-content">
                            <h3>Schlafberatung</h3>
                            <p>Schlaf ist ein wichtiges Thema für die ganze Familie - und manchmal eine echte Herausforderung. In der Schlafberatung schauen wir gemeinsam auf Eure individuelle Situation, Bedürfnisse und Möglichkeiten.</p>
                        </div>
                    </div>

                    <div class="service-card">
                        <img src="images/Beikost.jpg" alt="Beikost">
                        <div class="service-card-content">
                            <h3>Beikost <span class="sub-title">(auch vegan)</span></h3>
                            <p>Wann ist der richtige Zeitpunkt? Wie beginne ich am besten? Was passt zu meinem Kind und zu unserem Alltag? In der Beratung erhältst du fundierte Informationen rund um das Thema Beikost.</p>
                        </div>
                    </div>

                    <div class="service-card">
                        <img src="images/Stillberatung.jpg" alt="Stillen">
                        <div class="service-card-content">
                            <h3>Stillberatung</h3>
                            <p>Individuelle Stillberatung von Stillvorbereitung, Problemen während der Stillzeit bis hin zum bedürfnisorientiertem Abstillen. Für einen guten Start und eine harmonische Stillbeziehung.</p>
                        </div>
                    </div>
                    
                    <div class="service-card">
                        <img src="images/Workshops.jpg" alt="Workshops">
                        <div class="service-card-content">
                            <h3>Workshops & Vorträge</h3>
                            <p>In meinen Workshops teile ich mein Wissen zu verschiedenen Familienthemen. Eine tolle Möglichkeit, sich zu informieren und mit anderen Eltern auszutauschen.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="contact" class="container" style="margin-top: 40px;">
                <div class="section-title"><h2>Kontakt</h2></div>
                <form class="contact-form" id="contact-form">
                    <input type="text" name="from_name" placeholder="Dein Name" required>
                    <input type="email" name="from_email" placeholder="Deine E-Mail" required>
                    <textarea name="message" placeholder="Wie kann ich helfen?" rows="5" required></textarea>
                    
                    <div class="privacy-consent">
                        <input type="checkbox" id="privacy-check" name="privacy-consent" required style="width: auto; margin: 0;">
                        <label for="privacy-check">Ich stimme der <a href="https://www.muckiglueck.de/datenschutz">Datenschutzerklärung</a> zu.</label>
                    </div>

                    <button type="submit" class="btn" id="submit-btn" disabled>Absenden</button>
                </form>
                <div id="contact-status" style="margin-top: 15px; text-align: center; font-weight: bold;"></div>
            </section>
        </main>

        <div id="install-banner" class="install-banner" style="display: none;">
            <div class="install-content">
                <img src="images/icon-192.png" alt="Logo">
                <div class="install-text">
                    <strong>muckiglück als App?</strong>
                    <p>Für schnellen Zugriff zum Home-Bildschirm hinzufügen.</p>
                </div>
                <button onclick="showInstructions()" class="install-btn">Anleitung</button>
                <button onclick="document.getElementById('install-banner').style.display='none'" class="close-x">✕</button>
            </div>
        </div>

        <nav class="bottom-nav">
            <a href="#" class="nav-item active" onclick="setActive(this)">
                <i data-lucide="home"></i>
                <span>Home</span>
            </a>
            <a href="#services" class="nav-item" onclick="setActive(this)">
                <i data-lucide="heart-handshake"></i>
                <span>Angebot</span>
            </a>
            <a href="#contact" class="nav-item" onclick="setActive(this)">
                <i data-lucide="mail"></i>
                <span>Kontakt</span>
            </a>
            <a href="#" id="logout-btn" class="nav-item">
                <i data-lucide="log-out"></i>
                <span>Logout</span>
            </a>
        </nav>
    </div>

    <script type="module">
        // Firebase Konfiguration (DEINE DATEN)
        const firebaseConfig = {
            apiKey: "AIzaSyAlDyv4LGkYFzDWwVwVTpfyxEmpROz115o",
            authDomain: "muckiglueckauth.firebaseapp.com",
            projectId: "muckiglueckauth",
            storageBucket: "muckiglueckauth.firebasestorage.app",
            messagingSenderId: "550834074850",
            appId: "1:550834074850:web:e83a073d702b1fd9e09abb"
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Elemente
        const loadingOverlay = document.getElementById('loading-overlay');
        const mainContent = document.getElementById('main-content');
        const userEmailSpan = document.getElementById('user-email');
        const logoutBtn = document.getElementById('logout-btn');

        // Auth Check
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userEmailSpan.textContent = user.email.split('@')[0]; // Zeigt nur Namen vor dem @
                loadingOverlay.classList.add('hidden');
                mainContent.style.display = 'block';
                lucide.createIcons();
            } else {
                window.location.href = 'login.html';
            }
        });

        // Logout
        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            signOut(auth).catch((error) => console.error(error));
        });

        // Checkbox Logik
        const privacyCheckbox = document.getElementById('privacy-check');
        const submitButton = document.getElementById('submit-btn');
        if (privacyCheckbox && submitButton) {
            privacyCheckbox.addEventListener('change', () => {
                submitButton.disabled = !privacyCheckbox.checked;
            });
        }

        // Kontaktformular (Google Apps Script)
        const contactForm = document.getElementById('contact-form');
        const contactStatus = document.getElementById('contact-status');
        const googleScriptURL = 'https://script.google.com/macros/s/AKfycbz-52zOFxYlQoYkJjyf0W6US3eRO-WNIcE01NCim7Q49uEzCKin0Fo_d8ht0l8XuzEr/exec';

        contactForm.addEventListener('submit', e => {
            e.preventDefault();
            const btn = contactForm.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Sende...';
            
            fetch(googleScriptURL, { 
                method: 'POST', 
                body: new FormData(contactForm)
            })
            .then(res => res.json())
            .then(data => {
                if (data.result === 'success') {
                    contactStatus.textContent = 'Nachricht gesendet!';
                    contactStatus.style.color = '#8A9A5B';
                    contactForm.reset();
                } else { throw new Error(); }
            })
            .catch(() => {
                contactStatus.textContent = 'Fehler beim Senden.';
                contactStatus.style.color = 'red';
            })
            .finally(() => {
                btn.disabled = false;
                btn.textContent = 'Absenden';
            });
        });
    </script>
    
    <script>
        function setActive(element) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            lucide.createIcons(); // Icons neu rendern falls nötig
        }
    </script>
    <script>
        // 1. Variable für Android-Installation (NUR EINMAL deklarieren)
        let deferredPrompt; 

        // 2. Weichenstellung: Ist es ein iOS-Gerät?
        const isIos = () => {
            const userAgent = window.navigator.userAgent.toLowerCase();
            return /iphone|ipad|ipod/.test(userAgent);
        };

        const isInStandaloneMode = () => 
            ('standalone' in window.navigator) && (window.navigator.standalone);

        // 3. Logik beim Laden der Seite
        window.addEventListener('load', () => {
            const installContainer = document.getElementById('install-container');

            if (isIos() && !isInStandaloneMode()) {
                // SPEZIAL-HINWEIS FÜR iPHONE
                if (installContainer) {
                    installContainer.innerHTML = `
                        <div style="background: #fdf6e3; padding: 15px; border: 1px solid #eee8d5; border-radius: 15px; font-size: 0.9rem; text-align: left;">
                            <p style="margin: 0; color: #555;">
                                <strong>App installieren:</strong> Tippe unten auf das 
                                <strong>Teilen-Symbol</strong> (Quadrat mit Pfeil) 
                                und wähle <strong>'Zum Home-Bildschirm'</strong>.
                            </p>
                        </div>
                    `;
                    installContainer.style.display = 'block';
                    if(window.lucide) lucide.createIcons();
                }
            }
        });

        // 4. ANDROID LOGIK (beforeinstallprompt)
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installContainer = document.getElementById('install-container');
            if (installContainer && !isIos()) {
                installContainer.style.display = 'block';
            }
        });

        // 5. Button-Klick für Android
        const btnInstall = document.getElementById('btn-install');
        if (btnInstall) {
            btnInstall.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`Installation: ${outcome}`);
                    deferredPrompt = null;
                    document.getElementById('install-container').style.display = 'none';
                }
            });
        }

        // Navigation & UI Funktionen
        function setActive(element) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            if(window.lucide) lucide.createIcons();
        }
    </script>
</body>
</html>